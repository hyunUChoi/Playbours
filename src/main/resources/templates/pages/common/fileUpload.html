<!DOCTYPE html>
<html lang="en"
      class="light-style layout-menu-fixed"
      dir="ltr"
      data-theme="theme-default"
      data-assets-path="/manage/assets/"
      data-template="vertical-menu-template-free"
      xmlns:th="http://www.thymeleaf.org"
>
<div class="mb-3">
	<label for="atchFileForm" class="form-label">첨부파일</label>
	<th:block th:if="${#strings.contains(session.requestURI, 'insert')}">
		<input class="form-control" type="file" id="atchFileForm" onchange="fnFileUpload(this.files);"/>
	</th:block>
	<th:block th:if="${#strings.contains(session.requestURI, 'update')}">

	</th:block>
	<th:block th:if="${#strings.contains(session.requestURI, 'view')}">
		<th:block th:if="${#lists.size(resultList) gt 0}">
			<span class="form-control-plaintext" th:each="file : ${resultList}" th:text="${file.getOriginalFileNm()}"></span>
		</th:block>
		<th:block th:unless="${#lists.size(resultList) gt 0}">
			<span class="form-control-plaintext">첨부된 파일이 없습니다.</span>
		</th:block>
	</th:block>
</div>
<script th:inline="javascript">
	// 파일 하나당 최대 용량 10MB
	const LIMIT_BYTE = 10485760;

	function fnFileUpload(files) {
        if(files[0].size > LIMIT_BYTE) {
			alert("[" + files[0].name + "]은(는) 허용용량을 초과하여 첨부가 불가능합니다. 파일은 최대 10MB까지 첨부 가능합니다.");
            document.getElementById("atchFileForm").value = '';
            return false;

        } else {
            let formData = new FormData();
            formData.append("file", files[0]);

            fetch('/file/upload', {
				method: "POST",
				body: formData
			})
				.then(res => res.text())
				.then(data => {
					document.getElementById("atchFile").value = data;
				})
        }
	}
</script>
</html>