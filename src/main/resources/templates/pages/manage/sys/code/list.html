<!DOCTYPE html>
<html lang="en"
	  class="light-style layout-menu-fixed"
	  dir="ltr"
	  data-theme="theme-default"
	  data-assets-path="/manage/assets/"
	  data-template="vertical-menu-template-free"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{common/manage/layout/layout}"
	  layout:fragment="content"
>
<script th:inline="javascript">

	function fnGetCodeList(groupCode, id){

		const obj_size = document.getElementsByClassName(groupCode).length;
		if(obj_size > 0){
			for (i = 0; i < obj_size; i++) {
				document.getElementById(groupCode+"_"+ i).remove();
			}
			return false;
		}

		fetch('/ma/sys/code/getCodeList', {
			method: "POST",
			headers: {
				'Content-Type': 'application/json'
			},
			body: JSON.stringify({
				groupCode: groupCode
			})
		})
				.then(res => res.json())
				.then(data => {
					if(data.codeList.length > 0) {
						data.codeList.forEach((value, index) => {
							let content = '';
							content += '<td colspan=\"2\" style=\"text-align: right\">\(' + (index + 1) + '\)</td>' +
									'<td>' + value.name + '</td>' +
									'<td onCLick="fnGetCodeList(\'' + value.code + '\', \'' + (groupCode + "_" + index) + '\')">+</td>';
							const tr_box = document.createElement("tr");
							tr_box.id = (groupCode + "_" + index);
							tr_box.className = groupCode;
							tr_box.innerHTML = content;
							if (id !== '') {
								document.getElementById(id).after(tr_box);
							} else {
								document.getElementById(groupCode).after(tr_box);
							}

						});
					}else{
						alert("불러올 데이터가 없습니다.")
					}

				})
				.catch(error => alert('fetch 에러'));
	}
</script>
<h4 class="fw-bold py-3 mb-4">CODE</h4>
<div class="card">
	<form id="defaultFrm" th:object="${maCodeDto}" method="post" onsubmit="return false;">
		<input type="hidden" th:field="*{seq}"/>
		<div class="card-header">
			<table class="datatables-users table border-top dataTable no-footer dtr-column" style="width: 35%;">
				<colgroup>
					<col style="width:10%;">
					<col style="width:5%;">
					<col style="width:75%;">
					<col style="width:10%;">
				</colgroup>
				<thead>
				<tr>
					<th>No.</th>
					<th th:colspan="2">코드명</th>
					<th></th>
				</tr>
				</thead>
				<tbody id="tbody">
				<th:block th:if="${#lists.size(resultList) gt 0}">
					<tr th:id="${result.code}" varStatus="status" class="text-body" th:each="result, status : ${resultList}"  style="cursor: pointer;">
						<td th:text="${status.count}"></td>
						<td th:colspan="2" th:text="${result.name}"></td>
						<td onclick="fnGetCodeList(this.getAttribute('parameter'),'')" th:parameter="${result.code}">+</td>
					</tr>
				</th:block>
				</tbody>
			</table>
		</div>
	</form>
	<div class="card-datatable table-responsive">
		<div class="dataTables_wrapper dt-bootstrap5 no-footer">
			<div id="tbl"></div>
		</div>
	</div>
</div>
</html>
